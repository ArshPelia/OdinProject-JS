(()=>{"use strict";class t{constructor(t,i){this.hitsIncurred=0,this.length=t,this.orientation=i}hit(){this.hitsIncurred++}isSunk(){return this.hitsIncurred==this.length}}class i{constructor(t){this.name=t}}class e{orientations=["v","h"];constructor(t){this.rows=10,this.cols=10,this.board=[],this.ships=[],this.player=new i(t);for(let t=0;t<this.rows;t++){this.board[t]=[];for(let i=0;i<this.cols;i++)this.board[t].push(new s)}this.populateShips()}printToConsole(){const t=this.board.map((t=>t.map((t=>t.getValue()))));console.log(t)}populateShips(){const i=[5,4,3,3,2];for(const e of i){let i=!1;for(;!i;){const s=Math.floor(Math.random()*this.rows),r=Math.floor(Math.random()*this.cols),a=Math.random()<.5?"h":"v";if(i=this.validPlacement(e,s,r,a),i[0]){const a=new t(e,s,r,i[1]);for(let t=0;t<e;t++)"vertical"===i[1]?this.board[s][r+t].placeShip(a):this.board[s+t][r].placeShip(a);this.ships.push(a)}}}}validPlacement(t,i,e,s){if(i+t>this.rows||this.board[i][e].isOccupied())return[!1,""];if("v"==s){for(let s=e;s<e+t;s++)if(s>=this.cols||this.board[i][s].isOccupied())return[!1,""];for(let s=e;s<e+t;s++)if(s>=this.cols||this.board[i][s].isOccupied())return[!1,""];return e+t>=this.cols?[!1,""]:[!0,"vertical"]}for(let s=i;s<i+t;s++)if(s>=this.rows||this.board[s][e].isOccupied())return[!1,""];for(let s=i;s<i+t;s++)if(s>=this.rows||this.board[s][e].isOccupied())return[!1,""];return[!0,"horizontal"]}receiveAttack(t){const i=Math.floor((t-1)/10),e=(t-1)%10;if(i>=this.rows||e>=this.cols)return console.error("Invalid Hit: Out of Bounds"),-1;let s=this.board[i][e].strike();return console.log("Attack at ("+i+","+e+") => "+s),s}allSunk(){for(const t of this.ships)if(!t.isSunk())return!1;return!0}}class s{constructor(){this.ship=null,this.misHit=!1,this.value=""}placeShip(t){this.ship=t,this.value="X"}isOccupied(){return!!this.ship}getValue(){return this.value}strike(){return this.isOccupied()?(this.ship.hit(),!0):(this.misHit=!0,!1)}}class r{constructor(){this.b1=new e("P1"),this.b2=new e("P2"),this.activeBoard=this.b1,this.inactiveBoard=this.b2,this.gameOver=!1}switchActiveBoard(){this.activeBoard=this.activeBoard===this.b1?this.b2:this.b1,this.inactiveBoard=this.inactiveBoard===this.b1?this.b2:this.b1}checkForWinner(){return this.inactiveBoard.ships.every((t=>t.isSunk()))?(this.gameOver=!0,this.activeBoard.player):null}isGameOver(){return this.gameOver}playRound(t){const i=Math.floor((t-1)/10),e=(t-1)%10;console.log(`${this.activeBoard.player.name} is striking at: ${t}...`);let s=this.inactiveBoard.receiveAttack(t);this.activeBoard.board[i][e].value=1==s?"H":"M";const r=this.checkForWinner();var a;r&&(console.log(`Player ${r.name} wins!`),a=r.name,document.querySelector(".winner").textContent="Winner: "+a,document.querySelector(".board").remove()),this.switchActiveBoard()}}new class{constructor(){this.game=new r,this.playerTurnDiv=document.querySelector(".turn");const t=document.querySelector("#b1"),i=document.querySelector("#b2");this.activeBoardDiv=t,this.inactiveBoardDiv=i,this.updateScreen=()=>{const s=this.game.activeBoard.player;this.playerTurnDiv.textContent=`${s.name}'s turn...`,this.activeBoardDiv=s===this.game.b1.player?t:i,this.inactiveBoardDiv=this.activeBoardDiv===t?i:t,this.activeBoardDiv.addEventListener("click",e),this.inactiveBoardDiv.removeEventListener("click",e),this.updateBoard(this.activeBoardDiv,this.game.activeBoard),this.updateBoard(this.inactiveBoardDiv,this.game.inactiveBoard)};const e=t=>{console.log("click; active board: "+this.game.activeBoard.player.name);const i=t.target.dataset.idx;i&&t.currentTarget===this.activeBoardDiv&&(this.game.playRound(i),this.updateScreen())};this.updateScreen()}updateBoard(t,i){t.textContent="",i.board.forEach(((e,s)=>{e.forEach(((e,r)=>{const a=document.createElement("button");a.classList.add("cell"),a.dataset.idx=s*i.cols+r+1,a.textContent=e.getValue(),this.styleCell(a,e.getValue()),t.appendChild(a)}))}))}styleCell(t,i){switch(i){case"X":t.style.backgroundColor="red";break;case"M":t.style.backgroundColor="blue";break;case"H":t.style.backgroundColor="green"}}}})();